<div class="crear-usuario-container">
  <div class="floating-icons">
    <div class="icon"><mat-icon>fact_check</mat-icon></div>
    <div class="icon"><mat-icon>admin_panel_settings</mat-icon></div>
    <div class="icon"><mat-icon>published_with_changes</mat-icon></div>
    <div class="icon"><mat-icon>verified</mat-icon></div>
    <div class="icon"><mat-icon>rate_review</mat-icon></div>
    <div class="icon"><mat-icon>assignment_turned_in</mat-icon></div>
    <div class="icon"><mat-icon>gavel</mat-icon></div>
    <div class="icon"><mat-icon>workspace_premium</mat-icon></div>
  </div>

  <mat-card class="usuario-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon class="header-icon">fact_check</mat-icon>
        Gestión de Solicitudes de Cambio de Placa
      </mat-card-title>
      <mat-card-subtitle>Revise y procese solicitudes de cambio de placa de clientes</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="content-wrapper">
        
        <!-- Resumen de Estados -->
        <div class="stats-container">
          <div class="stat-card pendiente">
            <mat-icon>schedule</mat-icon>
            <div class="stat-info">
              <span class="stat-value">{{contarSolicitudesPorEstado('PENDIENTE')}}</span>
              <span class="stat-label">Pendientes</span>
            </div>
          </div>
          <div class="stat-card aprobada">
            <mat-icon>check_circle</mat-icon>
            <div class="stat-info">
              <span class="stat-value">{{contarSolicitudesPorEstado('APROBADA')}}</span>
              <span class="stat-label">Aprobadas</span>
            </div>
          </div>
          <div class="stat-card rechazada">
            <mat-icon>cancel</mat-icon>
            <div class="stat-info">
              <span class="stat-value">{{contarSolicitudesPorEstado('RECHAZADA')}}</span>
              <span class="stat-label">Rechazadas</span>
            </div>
          </div>
          <div class="stat-card total">
            <mat-icon>assignment</mat-icon>
            <div class="stat-info">
              <span class="stat-value">{{todasLasSolicitudes.length}}</span>
              <span class="stat-label">Total</span>
            </div>
          </div>
        </div>

        <!-- Lista de Solicitudes -->
        <div class="results-section" *ngIf="todasLasSolicitudes.length > 0">
          <h3 class="section-title">
            <mat-icon>list</mat-icon>
            Todas las Solicitudes ({{todasLasSolicitudes.length}})
          </h3>

          <div class="solicitudes-grid">
            <div class="solicitud-card" *ngFor="let solicitud of todasLasSolicitudes">
              
              <!-- Header de la tarjeta -->
              <div class="solicitud-header">
                <div class="solicitud-id">
                  <mat-icon>confirmation_number</mat-icon>
                  <span>Solicitud #{{solicitud.idSolicitudCambio}}</span>
                </div>
                <mat-chip [class]="obtenerEstadoInfo(solicitud.estado).class">
                  <mat-icon>{{obtenerEstadoInfo(solicitud.estado).icon}}</mat-icon>
                  {{obtenerEstadoInfo(solicitud.estado).text}}
                </mat-chip>
              </div>

              <!-- Información del Cliente -->
              <div class="cliente-info-card">
                <div class="cliente-header">
                  <mat-icon>account_circle</mat-icon>
                  <span class="cliente-nombre">{{solicitud.clienteInfo.nombreCompleto}}</span>
                </div>
                <div class="cliente-details">
                  <div class="detail-item">
                    <mat-icon>email</mat-icon>
                    <span>{{solicitud.clienteInfo.email}}</span>
                  </div>
                  <div class="detail-item">
                    <mat-icon>phone</mat-icon>
                    <span>{{solicitud.clienteInfo.telefono}}</span>
                  </div>
                </div>
              </div>

              <!-- Información de la solicitud -->
              <div class="solicitud-body">
                <div class="info-row">
                  <div class="info-label">
                    <mat-icon>event</mat-icon>
                    Fecha de Solicitud:
                  </div>
                  <div class="info-value">{{formatearFechaParaMostrar(solicitud.fechaSolicitud)}}</div>
                </div>

                <div class="info-row">
                  <div class="info-label">
                    <mat-icon>swap_horiz</mat-icon>
                    Cambio de Placa:
                  </div>
                  <div class="info-value placa-cambio">
                    <span class="placa-vieja">{{solicitud.vehiculoActual.placa}}</span>
                    <mat-icon class="arrow-icon">arrow_forward</mat-icon>
                    <span class="placa-nueva">{{solicitud.placaNueva}}</span>
                  </div>
                </div>

                <div class="info-row">
                  <div class="info-label">
                    <mat-icon>help_outline</mat-icon>
                    Motivo:
                  </div>
                  <div class="info-value">{{obtenerNombreMotivo(solicitud.motivo)}}</div>
                </div>

                <div class="info-row" *ngIf="solicitud.fechaRevision">
                  <div class="info-label">
                    <mat-icon>fact_check</mat-icon>
                    Fecha de Revisión:
                  </div>
                  <div class="info-value">{{formatearFechaParaMostrar(solicitud.fechaRevision)}}</div>
                </div>
              </div>

              <!-- Footer de la tarjeta -->
              <div class="solicitud-footer">
                <button mat-raised-button 
                        (click)="verDetalles(solicitud)"
                        class="btn-ver-detalles-card btn-secondary">
                  <mat-icon>visibility</mat-icon>
                  Ver Detalles
                </button>
                
                <button mat-raised-button 
                        *ngIf="solicitud.estado === 'PENDIENTE'"
                        (click)="abrirModalResolucion(solicitud)"
                        class="btn-resolver-card btn-primary">
                  <mat-icon>rate_review</mat-icon>
                  Resolver
                </button>

                <div *ngIf="solicitud.estado !== 'PENDIENTE'" class="estado-procesado">
                  <mat-icon>{{obtenerEstadoInfo(solicitud.estado).icon}}</mat-icon>
                  <span>Procesada</span>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Loading -->
        <div class="loading-container" *ngIf="isLoadingSolicitudes">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Cargando solicitudes...</p>
        </div>

        <!-- Sin resultados -->
        <div class="no-results" *ngIf="todasLasSolicitudes.length === 0 && !isLoadingSolicitudes">
          <mat-icon>inbox</mat-icon>
          <p>No hay solicitudes de cambio de placa</p>
          <p class="hint">Las solicitudes pendientes aparecerán aquí</p>
        </div>

      </div>
    </mat-card-content>
  </mat-card>

   <!-- Modal de Detalles Completos -->
  <div class="modal-overlay" *ngIf="mostrarModalDetalles" (click)="cerrarModalDetalles($event)">
    <div class="encargado-modal modal-detalles-grande" (click)="$event.stopPropagation()">
      
      <div class="modal-header">
        <div class="modal-icon">
          <mat-icon>assignment</mat-icon>
        </div>
        <h2>Detalles Completos de la Solicitud</h2>
      </div>

      <div class="modal-content" *ngIf="solicitudSeleccionada">
        
        <!-- Estado de la Solicitud -->
        <div class="estado-banner" [class]="obtenerClaseEstadoBanner(solicitudSeleccionada.estado)">
          <mat-icon>{{obtenerEstadoInfo(solicitudSeleccionada.estado).icon}}</mat-icon>
          <div class="estado-info">
            <span class="estado-titulo">Estado Actual:</span>
            <span class="estado-valor">{{obtenerEstadoInfo(solicitudSeleccionada.estado).text}}</span>
          </div>
        </div>

        <!-- Grid de 2 Columnas -->
        <div class="modal-grid-container">
          
          <!-- Columna Izquierda -->
          <div class="modal-column">

            <!-- Información del Cliente -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>account_circle</mat-icon>
                Información del Cliente
              </h3>
              
              <div class="info-list">
                <div class="info-item-compact">
                  <label>ID Usuario:</label>
                  <span>#{{solicitudSeleccionada.clienteInfo.idUsuario}}</span>
                </div>
                <div class="info-item-compact">
                  <label>Nombre Completo:</label>
                  <span>{{solicitudSeleccionada.clienteInfo.nombreCompleto}}</span>
                </div>
                <div class="info-item-compact">
                  <label>Email:</label>
                  <span>{{solicitudSeleccionada.clienteInfo.email}}</span>
                </div>
                <div class="info-item-compact">
                  <label>Teléfono:</label>
                  <span>{{solicitudSeleccionada.clienteInfo.telefono}}</span>
                </div>
                <div class="info-item-compact">
                  <label>CUI:</label>
                  <span>{{solicitudSeleccionada.clienteInfo.cui}}</span>
                </div>
                <div class="info-item-compact full-width-compact">
                  <label>Dirección:</label>
                  <span class="text-wrap">{{solicitudSeleccionada.clienteInfo.direccion}}</span>
                </div>
              </div>
            </div>

            <!-- Información General -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>description</mat-icon>
                Información de la Solicitud
              </h3>
              
              <div class="info-list">
                <div class="info-item-compact">
                  <label>ID Solicitud:</label>
                  <span>#{{solicitudSeleccionada.idSolicitudCambio}}</span>
                </div>
                <div class="info-item-compact">
                  <label>Fecha de Solicitud:</label>
                  <span>{{formatearFechaParaMostrar(solicitudSeleccionada.fechaSolicitud)}}</span>
                </div>
                <div class="info-item-compact">
                  <label>Motivo:</label>
                  <span>{{obtenerNombreMotivo(solicitudSeleccionada.motivo)}}</span>
                </div>
                <div class="info-item-compact full-width-compact">
                  <label>Descripción del Motivo:</label>
                  <span class="text-wrap">{{solicitudSeleccionada.descripcionMotivo}}</span>
                </div>
              </div>
            </div>

            <!-- Vehículo Actual -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>directions_car</mat-icon>
                Vehículo Actual
              </h3>
              
              <div class="vehiculo-card old-vehicle">
                <div class="vehiculo-placa">
                  <mat-icon>credit_card</mat-icon>
                  <span>{{solicitudSeleccionada.vehiculoActual.placa}}</span>
                </div>
                <div class="vehiculo-details">
                  <div class="detail-row">
                    <mat-icon>directions_car</mat-icon>
                    <span>{{solicitudSeleccionada.vehiculoActual.marca}} {{solicitudSeleccionada.vehiculoActual.modelo}}</span>
                  </div>
                  <div class="detail-row">
                    <mat-icon>palette</mat-icon>
                    <span>{{solicitudSeleccionada.vehiculoActual.color}}</span>
                  </div>
                  <div class="detail-row">
                    <mat-icon>{{obtenerIconoTipoVehiculo(solicitudSeleccionada.vehiculoActual.tipoVehiculo)}}</mat-icon>
                    <span>{{obtenerTextoTipoVehiculo(solicitudSeleccionada.vehiculoActual.tipoVehiculo)}}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Vehículo Nuevo -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>new_label</mat-icon>
                Vehículo Nuevo
              </h3>
              
              <div class="vehiculo-card new-vehicle">
                <div class="vehiculo-placa">
                  <mat-icon>credit_card</mat-icon>
                  <span>{{solicitudSeleccionada.vehiculoNuevo.placa}}</span>
                </div>
                <div class="vehiculo-details">
                  <div class="detail-row">
                    <mat-icon>directions_car</mat-icon>
                    <span>{{solicitudSeleccionada.vehiculoNuevo.marca}} {{solicitudSeleccionada.vehiculoNuevo.modelo}}</span>
                  </div>
                  <div class="detail-row">
                    <mat-icon>palette</mat-icon>
                    <span>{{solicitudSeleccionada.vehiculoNuevo.color}}</span>
                  </div>
                  <div class="detail-row">
                    <mat-icon>{{obtenerIconoTipoVehiculo(solicitudSeleccionada.vehiculoNuevo.tipoVehiculo)}}</mat-icon>
                    <span>{{obtenerTextoTipoVehiculo(solicitudSeleccionada.vehiculoNuevo.tipoVehiculo)}}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Documento de Evidencia -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>insert_drive_file</mat-icon>
                Documento de Respaldo
              </h3>
              
              <div class="documento-compact-card">
                <div class="documento-header-compact">
                  <mat-chip class="chip-documento">{{obtenerNombreTipoDocumento(solicitudSeleccionada.evidenciaCambioPlaca.tipoDocumento)}}</mat-chip>
                  <span class="documento-fecha">{{formatearFechaParaMostrar(solicitudSeleccionada.evidenciaCambioPlaca.fechaCarga)}}</span>
                </div>
                
                <div class="documento-preview-compact">
                  <img *ngIf="esImagen(solicitudSeleccionada.evidenciaCambioPlaca.nombreArchivo)" 
                       [src]="solicitudSeleccionada.evidenciaCambioPlaca.urlDocumento" 
                       [alt]="solicitudSeleccionada.evidenciaCambioPlaca.descripcion"
                       class="documento-imagen-compact">
                  
                  <div *ngIf="esPdf(solicitudSeleccionada.evidenciaCambioPlaca.nombreArchivo)" class="documento-icon-compact icon-pdf">
                    <mat-icon>picture_as_pdf</mat-icon>
                    <span>PDF</span>
                  </div>

                  <div *ngIf="esDocumento(solicitudSeleccionada.evidenciaCambioPlaca.nombreArchivo)" class="documento-icon-compact icon-doc">
                    <mat-icon>description</mat-icon>
                    <span>Word</span>
                  </div>
                </div>

                <div class="documento-info-compact">
                  <p class="documento-descripcion-compact">{{solicitudSeleccionada.evidenciaCambioPlaca.descripcion}}</p>
                  <p class="documento-nombre-compact">
                    <mat-icon>attach_file</mat-icon>
                    {{solicitudSeleccionada.evidenciaCambioPlaca.nombreArchivo}}
                  </p>
                  <a [href]="solicitudSeleccionada.evidenciaCambioPlaca.urlDocumento" 
                     (click)="abrirODescargarArchivo(solicitudSeleccionada.evidenciaCambioPlaca.urlDocumento, solicitudSeleccionada.evidenciaCambioPlaca.nombreArchivo, $event)"
                     mat-raised-button 
                     color="primary"
                     class="btn-documento-compact">
                    <mat-icon>{{obtenerIconoBoton(solicitudSeleccionada.evidenciaCambioPlaca.nombreArchivo)}}</mat-icon>
                    {{obtenerTextoBoton(solicitudSeleccionada.evidenciaCambioPlaca.nombreArchivo)}}
                  </a>
                </div>
              </div>
            </div>

            <!-- Información de Revisión -->
            <div class="info-section-compact" *ngIf="solicitudSeleccionada.fechaRevision">
              <h3 class="info-section-title-compact">
                <mat-icon>rate_review</mat-icon>
                Revisión de la Solicitud
              </h3>
              
              <div class="info-list">
                <div class="info-item-compact">
                  <label>Fecha de Revisión:</label>
                  <span>{{formatearFechaLegible(solicitudSeleccionada.fechaRevision)}}</span>
                </div>
                <div class="info-item-compact" *ngIf="solicitudSeleccionada.fechaEfectiva">
                  <label>Fecha Efectiva:</label>
                  <span>{{formatearFechaLegible(solicitudSeleccionada.fechaEfectiva)}}</span>
                </div>
                <div class="info-item-compact full-width-compact" *ngIf="solicitudSeleccionada.observacionesRevision">
                  <label>Observaciones:</label>
                  <span class="text-wrap observaciones-text">{{solicitudSeleccionada.observacionesRevision}}</span>
                </div>
              </div>
            </div>

          </div>

          <!-- Columna Derecha -->
          <div class="modal-column">

            <!-- Información de la Suscripción -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>card_membership</mat-icon>
                Suscripción Activa
              </h3>
              
              <div class="suscripcion-card">
                <div class="suscripcion-header">
                  <mat-icon>stars</mat-icon>
                  <span class="plan-nombre">{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.nombrePlan}}</span>
                  <mat-chip [class]="'chip-' + solicitudSeleccionada.suscripcionCliente.estadoSuscripcion.toLowerCase()">
                    {{solicitudSeleccionada.suscripcionCliente.estadoSuscripcion}}
                  </mat-chip>
                </div>

                <div class="info-list">
                  <div class="info-item-compact">
                    <label>ID Suscripción:</label>
                    <span>#{{solicitudSeleccionada.suscripcionCliente.idSuscripcion}}</span>
                  </div>
                  <div class="info-item-compact">
                    <label>Código del Plan:</label>
                    <span>{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.codigoPlan}}</span>
                  </div>
                  <div class="info-item-compact">
                    <label>Período Contratado:</label>
                    <span>{{solicitudSeleccionada.suscripcionCliente.periodoContratado}}</span>
                  </div>
                  <div class="info-item-compact full-width-compact">
                    <label>Descripción:</label>
                    <span class="text-wrap">{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.descripcion}}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Detalles del Plan -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>schedule</mat-icon>
                Detalles del Plan
              </h3>
              
              <div class="info-list">
                <div class="info-item-compact">
                  <label>Horas por Día:</label>
                  <span>{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.horasDia}} horas</span>
                </div>
                <div class="info-item-compact">
                  <label>Horas Mensuales:</label>
                  <span>{{solicitudSeleccionada.suscripcionCliente.horasMensualesIncluidas}} horas</span>
                </div>
                <div class="info-item-compact">
                  <label>Horas Consumidas:</label>
                  <span class="consumo-horas">{{solicitudSeleccionada.suscripcionCliente.horasConsumidas}} / {{solicitudSeleccionada.suscripcionCliente.horasMensualesIncluidas}}</span>
                </div>
                <div class="info-item-compact">
                  <label>Días Aplicables:</label>
                  <span>{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.diasAplicables}}</span>
                </div>
                <div class="info-item-compact full-width-compact">
                  <label>Cobertura Horaria:</label>
                  <span>{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.coberturaHoraria}}</span>
                </div>
              </div>
            </div>

            <!-- Información Financiera -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>payments</mat-icon>
                Información Financiera
              </h3>
              
              <div class="pricing-card">
                <div class="info-list">
                  <div class="info-item-compact">
                    <label>Precio Base del Plan:</label>
                    <span>{{formatearMoneda(solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.precioPlan)}}</span>
                  </div>
                  <div class="info-item-compact">
                    <label>Tarifa Base Ref.:</label>
                    <span>{{formatearMoneda(solicitudSeleccionada.suscripcionCliente.tarifaBaseReferencia)}}</span>
                  </div>
                  <div class="info-item-compact">
                    <label>Descuento Aplicado:</label>
                    <span class="descuento-text">{{solicitudSeleccionada.suscripcionCliente.descuentoAplicado}}%</span>
                  </div>
                  <div class="info-item-compact precio-final-item">
                    <label>Precio Final:</label>
                    <span class="precio-final-valor">{{formatearMoneda(calcularPrecioFinal(solicitudSeleccionada.suscripcionCliente))}}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Configuración de Descuento -->
            <div class="info-section-compact" *ngIf="solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.configuracionDescuento">
              <h3 class="info-section-title-compact">
                <mat-icon>local_offer</mat-icon>
                Configuración de Descuento
              </h3>
              
              <div class="info-list">
                <div class="info-item-compact">
                  <label>Descuento Mensual:</label>
                  <span>{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.configuracionDescuento.descuentoMensual}}%</span>
                </div>
                <div class="info-item-compact">
                  <label>Descuento Anual Adicional:</label>
                  <span>{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.configuracionDescuento.descuentoAnualAdicional}}%</span>
                </div>
                <div class="info-item-compact">
                  <label>Estado Configuración:</label>
                  <span>{{solicitudSeleccionada.suscripcionCliente.tipoPlanSuscripcionDTO.configuracionDescuento.estadoConfiguracion}}</span>
                </div>
              </div>
            </div>

            <!-- Fechas de la Suscripción -->
            <div class="info-section-compact">
              <h3 class="info-section-title-compact">
                <mat-icon>event</mat-icon>
                Fechas de la Suscripción
              </h3>
              
              <div class="info-list">
                <div class="info-item-compact">
                  <label>Fecha de Compra:</label>
                  <span>{{formatearFechaParaMostrar(solicitudSeleccionada.suscripcionCliente.fechaCompra)}}</span>
                </div>
                <div class="info-item-compact">
                  <label>Fecha de Inicio:</label>
                  <span>{{formatearFechaParaMostrar(solicitudSeleccionada.suscripcionCliente.fechaInicio)}}</span>
                </div>
                <div class="info-item-compact">
                  <label>Fecha de Fin:</label>
                  <span>{{formatearFechaParaMostrar(solicitudSeleccionada.suscripcionCliente.fechaFin)}}</span>
                </div>
              </div>
            </div>

            <!-- Sucursales Disponibles -->
            <div class="info-section-compact" *ngIf="solicitudSeleccionada.suscripcionCliente.sucursalesDisponibles.length > 0">
              <h3 class="info-section-title-compact">
                <mat-icon>location_on</mat-icon>
                Sucursales Disponibles ({{solicitudSeleccionada.suscripcionCliente.sucursalesDisponibles.length}})
              </h3>
              
              <div class="sucursales-list">
                <div class="sucursal-compact-card" *ngFor="let sucursal of solicitudSeleccionada.suscripcionCliente.sucursalesDisponibles">
                  <div class="sucursal-compact-header">
                    <mat-icon>place</mat-icon>
                    <span class="sucursal-nombre">{{sucursal.nombre}}</span>
                    <mat-chip [class]="'chip-' + sucursal.estado.toLowerCase()">{{sucursal.estado}}</mat-chip>
                  </div>
                  <div class="sucursal-compact-details">
                    <div class="detail-row-compact">
                      <mat-icon>location_on</mat-icon>
                      <span>{{sucursal.direccionCompleta}}, {{sucursal.ciudad}}, {{sucursal.departamento}}</span>
                    </div>
                    <div class="detail-row-compact">
                      <mat-icon>schedule</mat-icon>
                      <span>{{sucursal.horaApertura}} - {{sucursal.horaCierre}}</span>
                    </div>
                    <div class="detail-row-compact">
                      <mat-icon>local_parking</mat-icon>
                      <span>Capacidad: {{sucursal.capacidad2Ruedas}} motos / {{sucursal.capacidad4Ruedas}} autos</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

        </div>

      </div>

      <div class="modal-actions">
        <button mat-raised-button 
                color="primary" 
                (click)="cerrarModalDetalles()"
                class="close-button">
          <mat-icon>close</mat-icon>
          Cerrar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Resolución -->
  <div class="modal-overlay" *ngIf="mostrarModalResolucion" (click)="cerrarModalResolucion($event)">
    <div class="encargado-modal modal-resolucion" (click)="$event.stopPropagation()">
      
      <div class="modal-header">
        <div class="modal-icon">
          <mat-icon>rate_review</mat-icon>
        </div>
        <h2>Resolver Solicitud de Cambio de Placa</h2>
      </div>

      <div class="modal-content" *ngIf="solicitudSeleccionada">
        
        <!-- Resumen de la solicitud -->
        <div class="resumen-solicitud-card">
          <h3 class="resumen-title">
            <mat-icon>info</mat-icon>
            Resumen de la Solicitud
          </h3>

          <div class="resumen-grid">
            <div class="resumen-item">
              <label>ID Solicitud:</label>
              <span class="resumen-value">#{{solicitudSeleccionada.idSolicitudCambio}}</span>
            </div>
            <div class="resumen-item">
              <label>Cliente:</label>
              <span class="resumen-value">{{solicitudSeleccionada.clienteInfo.nombreCompleto}}</span>
            </div>
            <div class="resumen-item">
              <label>Fecha Solicitud:</label>
              <span class="resumen-value">{{formatearFechaParaMostrar(solicitudSeleccionada.fechaSolicitud)}}</span>
            </div>
            <div class="resumen-item">
              <label>Motivo:</label>
              <span class="resumen-value">{{obtenerNombreMotivo(solicitudSeleccionada.motivo)}}</span>
            </div>
          </div>

          <div class="resumen-cambio-placa">
            <label>Cambio de Placa:</label>
            <div class="cambio-visual">
              <div class="placa-box old">
                <mat-icon>directions_car</mat-icon>
                <span>{{solicitudSeleccionada.vehiculoActual.placa}}</span>
                <small>{{solicitudSeleccionada.vehiculoActual.marca}} {{solicitudSeleccionada.vehiculoActual.modelo}}</small>
              </div>
              <mat-icon class="arrow-change">arrow_forward</mat-icon>
              <div class="placa-box new">
                <mat-icon>directions_car</mat-icon>
                <span>{{solicitudSeleccionada.placaNueva}}</span>
                <small>{{solicitudSeleccionada.vehiculoNuevo.marca}} {{solicitudSeleccionada.vehiculoNuevo.modelo}}</small>
              </div>
            </div>
          </div>

          <div class="resumen-descripcion">
            <label>Descripción del Motivo:</label>
            <p>{{solicitudSeleccionada.descripcionMotivo}}</p>
          </div>
        </div>

        <!-- Formulario de resolución -->
        <form [formGroup]="resolucionForm" (ngSubmit)="resolverSolicitud()" class="resolucion-form">
          
          <div class="form-section-resolucion">
            <h3 class="form-section-title">
              <mat-icon>gavel</mat-icon>
              Decisión de Resolución
            </h3>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Decisión</mat-label>
              <mat-select formControlName="estado">
                <mat-option *ngFor="let estado of estadosResolucion" [value]="estado.value">
                  <div class="estado-option">
                    <span>{{estado.label}}</span>
                  </div>
                </mat-option>
              </mat-select>
              <mat-icon matPrefix>fact_check</mat-icon>
              <mat-error *ngIf="resolucionForm.get('estado')?.hasError('required')">
                Debe seleccionar una decisión
              </mat-error>
              <mat-hint>Seleccione si aprueba o rechaza la solicitud</mat-hint>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Observaciones de la Revisión</mat-label>
              <textarea matInput 
                        formControlName="observacionesRevision"
                        rows="5"
                        placeholder="Escriba las observaciones de su decisión..."></textarea>
              <mat-icon matPrefix>notes</mat-icon>
              <mat-hint align="end">{{resolucionForm.get('observacionesRevision')?.value?.length || 0}} caracteres</mat-hint>
              <mat-error *ngIf="resolucionForm.get('observacionesRevision')?.hasError('required')">
                Las observaciones son requeridas
              </mat-error>
              <mat-error *ngIf="resolucionForm.get('observacionesRevision')?.hasError('minlength')">
                Mínimo 10 caracteres
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Preview de la decisión -->
          <div class="decision-preview" *ngIf="resolucionForm.get('estado')?.value">
            <div class="preview-header" [class.preview-aprobada]="resolucionForm.get('estado')?.value === 'APROBADA'" 
                 [class.preview-rechazada]="resolucionForm.get('estado')?.value === 'RECHAZADA'">
              <mat-icon>{{resolucionForm.get('estado')?.value === 'APROBADA' ? 'check_circle' : 'cancel'}}</mat-icon>
              <span>{{resolucionForm.get('estado')?.value === 'APROBADA' ? 'Solicitud será APROBADA' : 'Solicitud será RECHAZADA'}}</span>
            </div>
            <p class="preview-warning">
              <mat-icon>warning</mat-icon>
              Esta acción notificará al cliente y actualizará el estado de la solicitud. Asegúrese de que la información sea correcta antes de continuar.
            </p>
          </div>

        </form>

      </div>

      <div class="modal-actions">
        <button mat-stroked-button 
                (click)="cerrarModalResolucion()"
                class="cancel-button-modal">
          <mat-icon>cancel</mat-icon>
          Cancelar
        </button>
        <button mat-raised-button 
                [disabled]="!resolucionForm.valid || isSavingResolucion"
                (click)="resolverSolicitud()"
                class="resolve-button"
                [class.resolve-button-aprobar]="resolucionForm.get('estado')?.value === 'APROBADA'"
                [class.resolve-button-rechazar]="resolucionForm.get('estado')?.value === 'RECHAZADA'">
          <mat-spinner *ngIf="isSavingResolucion" diameter="20" class="button-spinner"></mat-spinner>
          <mat-icon *ngIf="!isSavingResolucion">{{resolucionForm.get('estado')?.value === 'APROBADA' ? 'check_circle' : 'gavel'}}</mat-icon>
          <span *ngIf="!isSavingResolucion">{{resolucionForm.get('estado')?.value === 'APROBADA' ? 'Aprobar Solicitud' : 'Procesar Solicitud'}}</span>
          <span *ngIf="isSavingResolucion">Procesando...</span>
        </button>
      </div>
    </div>
  </div>
</div>